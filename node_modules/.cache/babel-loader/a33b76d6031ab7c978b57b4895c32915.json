{"ast":null,"code":"import _slicedToArray from \"/Users/ksenialasenko/Desktop/gitHub/train-master/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/ksenialasenko/Desktop/gitHub/train-master/src/js/SearchPage.js\";\nimport React, { Fragment, useContext, useState, useEffect } from 'react';\nimport { TrainpickerForm } from './TrainpickerForm';\nimport { ProgressSteps } from './ProgressSteps';\nimport { FiltersForm } from './FiltersForm';\nimport { LastTickets } from './LastTickets';\nimport { TrainCard } from './TrainCard';\nimport { Pagination } from './Pagination';\nimport { ApiServiceContext } from './context';\n\nfunction mergeArr(a, b) {\n  for (var i = 0; a.length;) {\n    b.splice(i++ * 2, 0, a.shift());\n  }\n\n  console.log(b);\n  return b;\n}\n\nvar SearchPage = function SearchPage(props) {\n  var api = useContext(ApiServiceContext);\n  var trains = props.trains,\n      setTrains = props.setTrains;\n  var trainsReverse = props.trainsReverse,\n      setTrainsReverse = props.setTrainsReverse;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      trainsArr = _useState2[0],\n      setTrainsArr = _useState2[1];\n\n  var params = props.searchParams || JSON.parse(sessionStorage.searchParams); // console.log(props);\n\n  var newParams = Object.assign({}, params);\n  ;\n  newParams.to = params.toReverse;\n  newParams.from = params.fromReverse; // console.log(newParams);\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      showNotice = _useState4[0],\n      setShowNotice = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      count = _useState6[0],\n      setCount = _useState6[1];\n\n  var _useState7 = useState('duration'),\n      _useState8 = _slicedToArray(_useState7, 2),\n      sortBy = _useState8[0],\n      setSortBy = _useState8[1];\n\n  var _useState9 = useState(5),\n      _useState10 = _slicedToArray(_useState9, 2),\n      limit = _useState10[0],\n      setLimit = _useState10[1];\n\n  var _useState11 = useState(0),\n      _useState12 = _slicedToArray(_useState11, 2),\n      offset = _useState12[0],\n      setOffset = _useState12[1];\n\n  var _useState13 = useState(1),\n      _useState14 = _slicedToArray(_useState13, 2),\n      currentPage = _useState14[0],\n      setCurrentPage = _useState14[1];\n\n  var update = function update(filters) {\n    params.filters = filters; // console.log(api.getRoutes(params, sortBy, limit, offset))\n\n    api.getRoutes(params, sortBy, limit, offset).then(function (response) {\n      sessionStorage.trains = JSON.stringify(response.items);\n      var count = response.items.length === 0 ? 0 : response.total_count;\n      setCount(count);\n      setTrains(response.items);\n\n      if (response.items.length === 0) {\n        setShowNotice(true);\n      }\n    });\n    api.getRoutes(newParams, sortBy, limit, offset).then(function (response) {\n      sessionStorage.trainsReverse = JSON.stringify(response.items);\n      var count = response.items.length === 0 ? 0 : response.total_count;\n      setCount(count); // setTrainsArr(mergeArr(trains, trainsReverse))\n\n      setTrainsReverse(response.items);\n\n      if (response.items.length === 0) {\n        setShowNotice(true);\n      }\n    }); // console.log(trainsArr)\n  };\n\n  useEffect(function () {\n    update(); // setTrainsArr(mergeArr(trains, trainsReverse));\n  }, [params.from.name, params.to.name, sortBy, limit, offset]);\n\n  var handleSortBy = function handleSortBy(event) {\n    var list = event.currentTarget;\n    var item = event.target;\n    list.classList.toggle('sort_list-open');\n    Array.from(list.children).forEach(function (el) {\n      return el.classList.remove('sort-by-current');\n    });\n    item.classList.add('sort-by-current');\n    setSortBy(item.dataset.sort);\n    setCurrentPage(1);\n  };\n\n  var handleLimit = function handleLimit(event) {\n    if (!event.target.classList.contains('limit-by')) {\n      return;\n    }\n\n    var list = event.currentTarget;\n    var item = event.target;\n    Array.from(list.children).forEach(function (el) {\n      return el.classList.remove('limit-by-current');\n    });\n    item.classList.add('limit-by-current');\n    setLimit(item.dataset.limit);\n    setCurrentPage(1);\n  };\n\n  var setPage = function setPage(page) {\n    setOffset(limit * (page - 1));\n    setCurrentPage(page);\n  }; // console.log(trainsArr)\n  // console.log(trains)\n\n\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, React.createElement(\"section\", {\n    className: \"columns\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(FiltersForm, Object.assign({}, props, {\n    update: update,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  })), React.createElement(LastTickets, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"col-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"results-display\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"trains-count\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"results-option\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, \"\\u041D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\"), React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, count)), React.createElement(\"div\", {\n    className: \"sort\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"results-option\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, \"\\u0441\\u043E\\u0440\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043F\\u043E:\"), React.createElement(\"ul\", {\n    onClick: handleSortBy,\n    className: \"sort_list\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"sort-by\",\n    \"data-sort\": \"date\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, \"\\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u044E\"), React.createElement(\"li\", {\n    className: \"sort-by sort-by-current\",\n    \"data-sort\": \"duration\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, \"\\u0434\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u0438\"))), React.createElement(\"div\", {\n    className: \"limit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"results-option\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, \"\\u043F\\u043E\\u043A\\u0430\\u0437\\u044B\\u0432\\u0430\\u0442\\u044C \\u043F\\u043E:\"), React.createElement(\"ul\", {\n    className: \"limit_list\",\n    onClick: handleLimit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"limit-by limit-by-current\",\n    \"data-limit\": 5,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, \"5\"), React.createElement(\"li\", {\n    className: \"limit-by\",\n    \"data-limit\": 10,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, \"10\"), React.createElement(\"li\", {\n    className: \"limit-by\",\n    \"data-limit\": 20,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, \"20\")))), trains.length > 0 ? // .map(train => train.reverse = {trainsReverse})\n  // mergeArr(trainsReverse, trains).\n  Object.assign(trainsReverse, trains).map(function (train) {\n    return (// train.push(f);\n      React.createElement(TrainCard, {\n        params: params,\n        departure: train.departure,\n        currentTrain: props.currentTrain,\n        setCurrentTrain: props.setCurrentTrain,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      })\n    );\n  }) : showNotice ? React.createElement(\"div\", {\n    className: \"not-found-notice\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, \"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0438\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B \\u043F\\u043E\\u0438\\u0441\\u043A\\u0430.\") : React.createElement(\"div\", {\n    className: \"loader\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"loader_image\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  })), React.createElement(Pagination, {\n    trains: trains,\n    count: count,\n    limit: limit,\n    currentPage: currentPage,\n    setCurrentPage: setPage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }))));\n};\n\nexport { SearchPage };","map":{"version":3,"sources":["/Users/ksenialasenko/Desktop/gitHub/train-master/src/js/SearchPage.js"],"names":["React","Fragment","useContext","useState","useEffect","TrainpickerForm","ProgressSteps","FiltersForm","LastTickets","TrainCard","Pagination","ApiServiceContext","mergeArr","a","b","i","length","splice","shift","console","log","SearchPage","props","api","trains","setTrains","trainsReverse","setTrainsReverse","trainsArr","setTrainsArr","params","searchParams","JSON","parse","sessionStorage","newParams","Object","assign","to","toReverse","from","fromReverse","showNotice","setShowNotice","count","setCount","sortBy","setSortBy","limit","setLimit","offset","setOffset","currentPage","setCurrentPage","update","filters","getRoutes","then","response","stringify","items","total_count","name","handleSortBy","event","list","currentTarget","item","target","classList","toggle","Array","children","forEach","el","remove","add","dataset","sort","handleLimit","contains","setPage","page","map","train","departure","currentTrain","setCurrentTrain"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,UAA1B,EAAsCC,QAAtC,EAAgDC,SAAhD,QAAiE,OAAjE;AACA,SAAQC,eAAR,QAA8B,mBAA9B;AACA,SAAQC,aAAR,QAA4B,iBAA5B;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,UAAT,QAA2B,cAA3B;AAEA,SAAQC,iBAAR,QAAgC,WAAhC;;AAGA,SAASC,QAAT,CAAkBC,CAAlB,EAAqBC,CAArB,EAAwB;AACtB,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBF,CAAC,CAACG,MAAlB;AACEF,IAAAA,CAAC,CAACG,MAAF,CAASF,CAAC,KAAK,CAAf,EAAkB,CAAlB,EAAqBF,CAAC,CAACK,KAAF,EAArB;AADF;;AAEEC,EAAAA,OAAO,CAACC,GAAR,CAAYN,CAAZ;AACF,SAAOA,CAAP;AACD;;AAID,IAAMO,UAAU,GAAG,SAAbA,UAAa,CAACC,KAAD,EAAW;AAC5B,MAAMC,GAAG,GAAGrB,UAAU,CAACS,iBAAD,CAAtB;AAD4B,MAErBa,MAFqB,GAEAF,KAFA,CAErBE,MAFqB;AAAA,MAEbC,SAFa,GAEAH,KAFA,CAEbG,SAFa;AAAA,MAGrBC,aAHqB,GAGcJ,KAHd,CAGrBI,aAHqB;AAAA,MAGNC,gBAHM,GAGcL,KAHd,CAGNK,gBAHM;;AAAA,kBAIMxB,QAAQ,EAJd;AAAA;AAAA,MAIrByB,SAJqB;AAAA,MAIVC,YAJU;;AAO5B,MAAMC,MAAM,GAAGR,KAAK,CAACS,YAAN,IAAsBC,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACH,YAA1B,CAArC,CAP4B,CAQ5B;;AACA,MAAMI,SAAS,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBP,MAAlB,CAAlB;AAA4C;AAC1CK,EAAAA,SAAS,CAACG,EAAV,GAAeR,MAAM,CAACS,SAAtB;AACAJ,EAAAA,SAAS,CAACK,IAAV,GAAiBV,MAAM,CAACW,WAAxB,CAX0B,CAY1B;;AAZ0B,mBAeQtC,QAAQ,CAAC,KAAD,CAfhB;AAAA;AAAA,MAerBuC,UAfqB;AAAA,MAeTC,aAfS;;AAAA,mBAgBFxC,QAAQ,CAAC,CAAD,CAhBN;AAAA;AAAA,MAgBrByC,KAhBqB;AAAA,MAgBdC,QAhBc;;AAAA,mBAiBA1C,QAAQ,CAAC,UAAD,CAjBR;AAAA;AAAA,MAiBrB2C,MAjBqB;AAAA,MAiBbC,SAjBa;;AAAA,mBAkBF5C,QAAQ,CAAC,CAAD,CAlBN;AAAA;AAAA,MAkBrB6C,KAlBqB;AAAA,MAkBdC,QAlBc;;AAAA,oBAmBA9C,QAAQ,CAAC,CAAD,CAnBR;AAAA;AAAA,MAmBrB+C,MAnBqB;AAAA,MAmBbC,SAnBa;;AAAA,oBAoBUhD,QAAQ,CAAC,CAAD,CApBlB;AAAA;AAAA,MAoBrBiD,WApBqB;AAAA,MAoBRC,cApBQ;;AAsB5B,MAAMC,MAAM,GAAG,SAATA,MAAS,CAACC,OAAD,EAAa;AAC1BzB,IAAAA,MAAM,CAACyB,OAAP,GAAiBA,OAAjB,CAD0B,CAE1B;;AACAhC,IAAAA,GAAG,CAACiC,SAAJ,CAAc1B,MAAd,EAAsBgB,MAAtB,EAA8BE,KAA9B,EAAqCE,MAArC,EACCO,IADD,CACM,UAAAC,QAAQ,EAAI;AACdxB,MAAAA,cAAc,CAACV,MAAf,GAAwBQ,IAAI,CAAC2B,SAAL,CAAeD,QAAQ,CAACE,KAAxB,CAAxB;AACA,UAAMhB,KAAK,GAAGc,QAAQ,CAACE,KAAT,CAAe5C,MAAf,KAA0B,CAA1B,GAA8B,CAA9B,GAAkC0C,QAAQ,CAACG,WAAzD;AACAhB,MAAAA,QAAQ,CAACD,KAAD,CAAR;AACAnB,MAAAA,SAAS,CAACiC,QAAQ,CAACE,KAAV,CAAT;;AACA,UAAIF,QAAQ,CAACE,KAAT,CAAe5C,MAAf,KAA0B,CAA9B,EAAiC;AAC/B2B,QAAAA,aAAa,CAAC,IAAD,CAAb;AACD;AACF,KATH;AAcApB,IAAAA,GAAG,CAACiC,SAAJ,CAAcrB,SAAd,EAAyBW,MAAzB,EAAiCE,KAAjC,EAAwCE,MAAxC,EACCO,IADD,CACM,UAAAC,QAAQ,EAAI;AACdxB,MAAAA,cAAc,CAACR,aAAf,GAA+BM,IAAI,CAAC2B,SAAL,CAAeD,QAAQ,CAACE,KAAxB,CAA/B;AACA,UAAMhB,KAAK,GAAGc,QAAQ,CAACE,KAAT,CAAe5C,MAAf,KAA0B,CAA1B,GAA8B,CAA9B,GAAkC0C,QAAQ,CAACG,WAAzD;AACAhB,MAAAA,QAAQ,CAACD,KAAD,CAAR,CAHc,CAId;;AACAjB,MAAAA,gBAAgB,CAAC+B,QAAQ,CAACE,KAAV,CAAhB;;AACA,UAAIF,QAAQ,CAACE,KAAT,CAAe5C,MAAf,KAA0B,CAA9B,EAAiC;AAC/B2B,QAAAA,aAAa,CAAC,IAAD,CAAb;AACD;AACF,KAVH,EAjB0B,CA6B1B;AAED,GA/BD;;AAiCAvC,EAAAA,SAAS,CAAC,YAAM;AACdkD,IAAAA,MAAM,GADQ,CAEd;AAED,GAJQ,EAIN,CAACxB,MAAM,CAACU,IAAP,CAAYsB,IAAb,EAAmBhC,MAAM,CAACQ,EAAP,CAAUwB,IAA7B,EAAmChB,MAAnC,EAA2CE,KAA3C,EAAkDE,MAAlD,CAJM,CAAT;;AAMA,MAAMa,YAAY,GAAG,SAAfA,YAAe,CAAAC,KAAK,EAAI;AAC5B,QAAMC,IAAI,GAAGD,KAAK,CAACE,aAAnB;AACA,QAAMC,IAAI,GAAGH,KAAK,CAACI,MAAnB;AACAH,IAAAA,IAAI,CAACI,SAAL,CAAeC,MAAf,CAAsB,gBAAtB;AACAC,IAAAA,KAAK,CAAC/B,IAAN,CAAWyB,IAAI,CAACO,QAAhB,EAA0BC,OAA1B,CAAkC,UAAAC,EAAE;AAAA,aAAIA,EAAE,CAACL,SAAH,CAAaM,MAAb,CAAoB,iBAApB,CAAJ;AAAA,KAApC;AACAR,IAAAA,IAAI,CAACE,SAAL,CAAeO,GAAf,CAAmB,iBAAnB;AACA7B,IAAAA,SAAS,CAACoB,IAAI,CAACU,OAAL,CAAaC,IAAd,CAAT;AACAzB,IAAAA,cAAc,CAAC,CAAD,CAAd;AACD,GARD;;AAUA,MAAM0B,WAAW,GAAG,SAAdA,WAAc,CAAAf,KAAK,EAAI;AAC3B,QAAI,CAACA,KAAK,CAACI,MAAN,CAAaC,SAAb,CAAuBW,QAAvB,CAAgC,UAAhC,CAAL,EAAkD;AAChD;AACD;;AACD,QAAMf,IAAI,GAAGD,KAAK,CAACE,aAAnB;AACA,QAAMC,IAAI,GAAGH,KAAK,CAACI,MAAnB;AACAG,IAAAA,KAAK,CAAC/B,IAAN,CAAWyB,IAAI,CAACO,QAAhB,EAA0BC,OAA1B,CAAkC,UAAAC,EAAE;AAAA,aAAIA,EAAE,CAACL,SAAH,CAAaM,MAAb,CAAoB,kBAApB,CAAJ;AAAA,KAApC;AACAR,IAAAA,IAAI,CAACE,SAAL,CAAeO,GAAf,CAAmB,kBAAnB;AACA3B,IAAAA,QAAQ,CAACkB,IAAI,CAACU,OAAL,CAAa7B,KAAd,CAAR;AACAK,IAAAA,cAAc,CAAC,CAAD,CAAd;AACD,GAVD;;AAYA,MAAM4B,OAAO,GAAG,SAAVA,OAAU,CAACC,IAAD,EAAU;AACxB/B,IAAAA,SAAS,CAACH,KAAK,IAAIkC,IAAI,GAAG,CAAX,CAAN,CAAT;AACA7B,IAAAA,cAAc,CAAC6B,IAAD,CAAd;AACD,GAHD,CAnF4B,CA4F9B;AACA;;;AAGE,SAEE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAS,IAAA,SAAS,EAAC,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,WAAD,oBAAiB5D,KAAjB;AAAwB,IAAA,MAAM,EAAEgC,MAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADF,EAEE,oBAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CADF,EAKE;AAAK,IAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAM,IAAA,SAAS,EAAC,gBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kDADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAOV,KAAP,CAFF,CADF,EAKE;AAAK,IAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAM,IAAA,SAAS,EAAC,gBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wFADF,EAEE;AAAI,IAAA,OAAO,EAAEmB,YAAb;AAA2B,IAAA,SAAS,EAAC,WAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAI,IAAA,SAAS,EAAC,SAAd;AAAwB,iBAAU,MAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0EADF,EAEE;AAAI,IAAA,SAAS,EAAC,yBAAd;AAAwC,iBAAU,UAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gFAFF,CAFF,CALF,EAYE;AAAK,IAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAM,IAAA,SAAS,EAAC,gBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kFADF,EAEE;AAAI,IAAA,SAAS,EAAC,YAAd;AAA2B,IAAA,OAAO,EAAEgB,WAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAI,IAAA,SAAS,EAAC,2BAAd;AAA0C,kBAAY,CAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SADF,EAEE;AAAI,IAAA,SAAS,EAAC,UAAd;AAAyB,kBAAY,EAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAFF,EAGE;AAAI,IAAA,SAAS,EAAC,UAAd;AAAyB,kBAAY,EAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAHF,CAFF,CAZF,CADF,EAuBGvD,MAAM,CAACR,MAAP,GAAgB,CAAhB,GACC;AACA;AACAoB,EAAAA,MAAM,CAACC,MAAP,CAAcX,aAAd,EAA6BF,MAA7B,EAAqC2D,GAArC,CAAyC,UAAAC,KAAK;AAAA,WAC5C;AAEF,0BAAC,SAAD;AACoB,QAAA,MAAM,EAAEtD,MAD5B;AAEoB,QAAA,SAAS,EAAEsD,KAAK,CAACC,SAFrC;AAIoB,QAAA,YAAY,EAAE/D,KAAK,CAACgE,YAJxC;AAKoB,QAAA,eAAe,EAAEhE,KAAK,CAACiE,eAL3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAH8C;AAAA,GAA9C,CAHD,GAYC7C,UAAU,GAAG;AAAK,IAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+WAAH,GAAmH;AAAK,IAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAwB;AAAK,IAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAxB,CAnCjI,EAmDE,oBAAC,UAAD;AACI,IAAA,MAAM,EAAElB,MADZ;AAEI,IAAA,KAAK,EAAEoB,KAFX;AAGI,IAAA,KAAK,EAAEI,KAHX;AAII,IAAA,WAAW,EAAEI,WAJjB;AAKI,IAAA,cAAc,EAAE6B,OALpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAnDF,CALF,CADF,CAFF;AAsED,CAtKD;;AAwKA,SAAQ5D,UAAR","sourcesContent":["import React, { Fragment, useContext, useState, useEffect } from 'react';\nimport {TrainpickerForm} from './TrainpickerForm'\nimport {ProgressSteps} from './ProgressSteps'\nimport { FiltersForm } from './FiltersForm';\nimport { LastTickets } from './LastTickets'\nimport { TrainCard } from './TrainCard';\nimport { Pagination } from './Pagination'; \n\nimport {ApiServiceContext} from './context';\n\n\nfunction mergeArr(a, b) {\n  for (var i = 0; a.length;)\n    b.splice(i++ * 2, 0, a.shift());\n    console.log(b)\n  return b;\n}\n\n\n\nconst SearchPage = (props) => {\n  const api = useContext(ApiServiceContext);\n  const {trains, setTrains} = props;\n  const {trainsReverse, setTrainsReverse} = props;\n  const [trainsArr, setTrainsArr] = useState();\n\n\n  const params = props.searchParams || JSON.parse(sessionStorage.searchParams);\n  // console.log(props);\n  const newParams = Object.assign({}, params);;\n    newParams.to = params.toReverse;\n    newParams.from = params.fromReverse;\n    // console.log(newParams);\n\n\n  const [showNotice, setShowNotice] = useState(false);\n  const [count, setCount] = useState(0);\n  const [sortBy, setSortBy] = useState('duration');\n  const [limit, setLimit] = useState(5);\n  const [offset, setOffset] = useState(0);\n  const [currentPage, setCurrentPage] = useState(1);\n\n  const update = (filters) => {\n    params.filters = filters; \n    // console.log(api.getRoutes(params, sortBy, limit, offset))\n    api.getRoutes(params, sortBy, limit, offset)\n    .then(response => {\n        sessionStorage.trains = JSON.stringify(response.items);\n        const count = response.items.length === 0 ? 0 : response.total_count;\n        setCount(count);\n        setTrains(response.items);\n        if (response.items.length === 0) {\n          setShowNotice(true);\n        } \n      }\n    );\n\n    \n\n    api.getRoutes(newParams, sortBy, limit, offset)\n    .then(response => {\n        sessionStorage.trainsReverse = JSON.stringify(response.items);\n        const count = response.items.length === 0 ? 0 : response.total_count;\n        setCount(count);\n        // setTrainsArr(mergeArr(trains, trainsReverse))\n        setTrainsReverse(response.items);\n        if (response.items.length === 0) {\n          setShowNotice(true);\n        } \n      }\n    );\n    // console.log(trainsArr)\n    \n  }\n\n  useEffect(() => {\n    update();\n    // setTrainsArr(mergeArr(trains, trainsReverse));\n\n  }, [params.from.name, params.to.name, sortBy, limit, offset]);\n\n  const handleSortBy = event => {\n    const list = event.currentTarget;\n    const item = event.target;\n    list.classList.toggle('sort_list-open');\n    Array.from(list.children).forEach(el => el.classList.remove('sort-by-current'));\n    item.classList.add('sort-by-current');\n    setSortBy(item.dataset.sort);\n    setCurrentPage(1);\n  }\n  \n  const handleLimit = event => {\n    if (!event.target.classList.contains('limit-by')) {\n      return;\n    }\n    const list = event.currentTarget;\n    const item = event.target;\n    Array.from(list.children).forEach(el => el.classList.remove('limit-by-current'));\n    item.classList.add('limit-by-current');\n    setLimit(item.dataset.limit);\n    setCurrentPage(1);\n  }\n\n  const setPage = (page) => {\n    setOffset(limit * (page - 1));\n    setCurrentPage(page);\n  }\n\n  \n\n  \n\n// console.log(trainsArr)\n// console.log(trains)\n\n\n  return  (\n    \n    <Fragment>\n      <section className=\"columns\">\n        <div className=\"col-left\">\n          <FiltersForm {...props} update={update} />\n          <LastTickets />\n        </div>\n        <div className=\"col-right\">\n          <div className=\"results-display\">\n            <div className=\"trains-count\">\n              <span className=\"results-option\">Найдено</span>\n              <span>{count}</span>\n            </div>\n            <div className=\"sort\">\n              <span className=\"results-option\">сортировать по:</span>\n              <ul onClick={handleSortBy} className=\"sort_list\">\n                <li className=\"sort-by\" data-sort=\"date\">отправлению</li>\n                <li className=\"sort-by sort-by-current\" data-sort=\"duration\">длительности</li>\n              </ul>\n            </div>\n            <div className=\"limit\">\n              <span className=\"results-option\">показывать по:</span>\n              <ul className=\"limit_list\" onClick={handleLimit}>\n                <li className=\"limit-by limit-by-current\" data-limit={5}>5</li>\n                <li className=\"limit-by\" data-limit={10}>10</li>\n                <li className=\"limit-by\" data-limit={20}>20</li>\n              </ul>\n            </div>\n          </div>\n          \n          {trains.length > 0 ? \n            // .map(train => train.reverse = {trainsReverse})\n            // mergeArr(trainsReverse, trains).\n            Object.assign(trainsReverse, trains).map(train => \n              // train.push(f);\n            \n            <TrainCard \n                                params={params}\n                                departure={train.departure} \n                                \n                                currentTrain={props.currentTrain} \n                                setCurrentTrain={props.setCurrentTrain}/>) :\n            showNotice ? <div className=\"not-found-notice\">К сожалению, ничего не найдено. Попробуйте изменить параметры поиска.</div> : <div className=\"loader\"><div className=\"loader_image\"></div></div>\n          }\n          {/* {trains.length > 0 ? \n            trainsReverse.map(train => <TrainCard \n                                params={params}\n                                departure={train.departure} \n                                \n                                currentTrain={props.currentTrain} \n                                setCurrentTrain={props.setCurrentTrain}/>) :\n            showNotice ? <div className=\"not-found-notice\">К сожалению, ничего не найдено. Попробуйте изменить параметры поиска.</div> : <div className=\"loader\"><div className=\"loader_image\"></div></div>\n          } */}\n\n          \n\n          \n\n          <Pagination \n              trains={trains}\n              count={count} \n              limit={limit} \n              currentPage={currentPage}\n              setCurrentPage={setPage}/> \n        </div>\n      </section>\n    </Fragment>\n  )\n  \n}\n\nexport {SearchPage}\n"]},"metadata":{},"sourceType":"module"}