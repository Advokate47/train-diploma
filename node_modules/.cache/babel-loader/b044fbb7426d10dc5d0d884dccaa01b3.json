{"ast":null,"code":"import _slicedToArray from \"/Users/ksenialasenko/Desktop/gitHub/train-master/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/ksenialasenko/Desktop/gitHub/train-master/src/js/SearchPage.js\";\nimport React, { Fragment, useContext, useState, useEffect } from 'react';\nimport { TrainpickerForm } from './TrainpickerForm';\nimport { ProgressSteps } from './ProgressSteps';\nimport { FiltersForm } from './FiltersForm';\nimport { LastTickets } from './LastTickets';\nimport { TrainCard } from './TrainCard';\nimport { Pagination } from './Pagination';\nimport { ApiServiceContext } from './context';\n\nvar SearchPage = function SearchPage(props) {\n  var api = useContext(ApiServiceContext);\n  var trains = props.trains,\n      setTrains = props.setTrains;\n  var params = props.searchParams || JSON.parse(sessionStorage.searchParams); // console.log(props);\n\n  var newParams = Object.assign({}, params);\n  ; // newParams.to = params.toReverse;\n  // newParams.from = params.fromReverse;\n\n  console.log(newParams);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      showNotice = _useState2[0],\n      setShowNotice = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      count = _useState4[0],\n      setCount = _useState4[1];\n\n  var _useState5 = useState('duration'),\n      _useState6 = _slicedToArray(_useState5, 2),\n      sortBy = _useState6[0],\n      setSortBy = _useState6[1];\n\n  var _useState7 = useState(5),\n      _useState8 = _slicedToArray(_useState7, 2),\n      limit = _useState8[0],\n      setLimit = _useState8[1];\n\n  var _useState9 = useState(0),\n      _useState10 = _slicedToArray(_useState9, 2),\n      offset = _useState10[0],\n      setOffset = _useState10[1];\n\n  var _useState11 = useState(1),\n      _useState12 = _slicedToArray(_useState11, 2),\n      currentPage = _useState12[0],\n      setCurrentPage = _useState12[1];\n\n  var update = function update(filters) {\n    params.filters = filters; // console.log(api.getRoutes(params, sortBy, limit, offset))\n\n    api.getRoutes(params, sortBy, limit, offset).then(function (response) {\n      sessionStorage.trains = JSON.stringify(response.items);\n      var count = response.items.length === 0 ? 0 : response.total_count;\n      setCount(count);\n      setTrains(response.items);\n\n      if (response.items.length === 0) {\n        setShowNotice(true);\n      }\n    }); // api.getRoutes(newParams, sortBy, limit, offset)\n    // .then(response => {\n    //     sessionStorage.trainsReverse = JSON.stringify(response.items);\n    //     const count = response.items.length === 0 ? 0 : response.total_count;\n    //     setCount(count);\n    //     setTrainsReverse(response.items);\n    //     if (response.items.length === 0) {\n    //       setShowNotice(true);\n    //     } \n    //   }\n    // );\n  };\n\n  useEffect(function () {\n    update();\n  }, [params.from.name, params.to.name, sortBy, limit, offset]);\n\n  var handleSortBy = function handleSortBy(event) {\n    var list = event.currentTarget;\n    var item = event.target;\n    list.classList.toggle('sort_list-open');\n    Array.from(list.children).forEach(function (el) {\n      return el.classList.remove('sort-by-current');\n    });\n    item.classList.add('sort-by-current');\n    setSortBy(item.dataset.sort);\n    setCurrentPage(1);\n  };\n\n  var handleLimit = function handleLimit(event) {\n    if (!event.target.classList.contains('limit-by')) {\n      return;\n    }\n\n    var list = event.currentTarget;\n    var item = event.target;\n    Array.from(list.children).forEach(function (el) {\n      return el.classList.remove('limit-by-current');\n    });\n    item.classList.add('limit-by-current');\n    setLimit(item.dataset.limit);\n    setCurrentPage(1);\n  };\n\n  var setPage = function setPage(page) {\n    setOffset(limit * (page - 1));\n    setCurrentPage(page);\n  };\n\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, React.createElement(\"section\", {\n    className: \"columns\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, React.createElement(FiltersForm, Object.assign({}, props, {\n    update: update,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  })), React.createElement(LastTickets, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"col-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"results-display\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"trains-count\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"results-option\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, \"\\u041D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\"), React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, count)), React.createElement(\"div\", {\n    className: \"sort\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"results-option\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }, \"\\u0441\\u043E\\u0440\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043F\\u043E:\"), React.createElement(\"ul\", {\n    onClick: handleSortBy,\n    className: \"sort_list\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"sort-by\",\n    \"data-sort\": \"date\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, \"\\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u044E\"), React.createElement(\"li\", {\n    className: \"sort-by sort-by-current\",\n    \"data-sort\": \"duration\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, \"\\u0434\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u0438\"))), React.createElement(\"div\", {\n    className: \"limit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"results-option\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, \"\\u043F\\u043E\\u043A\\u0430\\u0437\\u044B\\u0432\\u0430\\u0442\\u044C \\u043F\\u043E:\"), React.createElement(\"ul\", {\n    className: \"limit_list\",\n    onClick: handleLimit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"limit-by limit-by-current\",\n    \"data-limit\": 5,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, \"5\"), React.createElement(\"li\", {\n    className: \"limit-by\",\n    \"data-limit\": 10,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, \"10\"), React.createElement(\"li\", {\n    className: \"limit-by\",\n    \"data-limit\": 20,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, \"20\")))), trains.length > 0 ? trains.map(function (train) {\n    return React.createElement(TrainCard, {\n      params: params,\n      departure: train.departure,\n      currentTrain: props.currentTrain,\n      setCurrentTrain: props.setCurrentTrain,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    });\n  }) : showNotice ? React.createElement(\"div\", {\n    className: \"not-found-notice\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, \"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0438\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B \\u043F\\u043E\\u0438\\u0441\\u043A\\u0430.\") : React.createElement(\"div\", {\n    className: \"loader\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"loader_image\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  })), React.createElement(Pagination, {\n    trains: trains,\n    count: count,\n    limit: limit,\n    currentPage: currentPage,\n    setCurrentPage: setPage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }))));\n};\n\nexport { SearchPage };","map":{"version":3,"sources":["/Users/ksenialasenko/Desktop/gitHub/train-master/src/js/SearchPage.js"],"names":["React","Fragment","useContext","useState","useEffect","TrainpickerForm","ProgressSteps","FiltersForm","LastTickets","TrainCard","Pagination","ApiServiceContext","SearchPage","props","api","trains","setTrains","params","searchParams","JSON","parse","sessionStorage","newParams","Object","assign","console","log","showNotice","setShowNotice","count","setCount","sortBy","setSortBy","limit","setLimit","offset","setOffset","currentPage","setCurrentPage","update","filters","getRoutes","then","response","stringify","items","length","total_count","from","name","to","handleSortBy","event","list","currentTarget","item","target","classList","toggle","Array","children","forEach","el","remove","add","dataset","sort","handleLimit","contains","setPage","page","map","train","departure","currentTrain","setCurrentTrain"],"mappings":"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","sourcesContent":["import React, { Fragment, useContext, useState, useEffect } from 'react';\nimport {TrainpickerForm} from './TrainpickerForm'\nimport {ProgressSteps} from './ProgressSteps'\nimport { FiltersForm } from './FiltersForm';\nimport { LastTickets } from './LastTickets'\nimport { TrainCard } from './TrainCard';\nimport { Pagination } from './Pagination'; \n\nimport {ApiServiceContext} from './context';\n\n\n\nconst SearchPage = (props) => {\n  const api = useContext(ApiServiceContext);\n  const {trains, setTrains} = props;\n\n\n  const params = props.searchParams || JSON.parse(sessionStorage.searchParams);\n  // console.log(props);\n  const newParams = Object.assign({}, params);;\n    // newParams.to = params.toReverse;\n    // newParams.from = params.fromReverse;\n    console.log(newParams);\n\n\n  const [showNotice, setShowNotice] = useState(false);\n  const [count, setCount] = useState(0);\n  const [sortBy, setSortBy] = useState('duration');\n  const [limit, setLimit] = useState(5);\n  const [offset, setOffset] = useState(0);\n  const [currentPage, setCurrentPage] = useState(1);\n\n  const update = (filters) => {\n    params.filters = filters; \n    // console.log(api.getRoutes(params, sortBy, limit, offset))\n    api.getRoutes(params, sortBy, limit, offset)\n    .then(response => {\n        sessionStorage.trains = JSON.stringify(response.items);\n        const count = response.items.length === 0 ? 0 : response.total_count;\n        setCount(count);\n        setTrains(response.items);\n        if (response.items.length === 0) {\n          setShowNotice(true);\n        } \n      }\n    );\n\n    \n\n    // api.getRoutes(newParams, sortBy, limit, offset)\n    // .then(response => {\n    //     sessionStorage.trainsReverse = JSON.stringify(response.items);\n    //     const count = response.items.length === 0 ? 0 : response.total_count;\n    //     setCount(count);\n    //     setTrainsReverse(response.items);\n    //     if (response.items.length === 0) {\n    //       setShowNotice(true);\n    //     } \n    //   }\n    // );\n  }\n\n  useEffect(() => {\n    update();\n  }, [params.from.name, params.to.name, sortBy, limit, offset]);\n\n  const handleSortBy = event => {\n    const list = event.currentTarget;\n    const item = event.target;\n    list.classList.toggle('sort_list-open');\n    Array.from(list.children).forEach(el => el.classList.remove('sort-by-current'));\n    item.classList.add('sort-by-current');\n    setSortBy(item.dataset.sort);\n    setCurrentPage(1);\n  }\n  \n  const handleLimit = event => {\n    if (!event.target.classList.contains('limit-by')) {\n      return;\n    }\n    const list = event.currentTarget;\n    const item = event.target;\n    Array.from(list.children).forEach(el => el.classList.remove('limit-by-current'));\n    item.classList.add('limit-by-current');\n    setLimit(item.dataset.limit);\n    setCurrentPage(1);\n  }\n\n  const setPage = (page) => {\n    setOffset(limit * (page - 1));\n    setCurrentPage(page);\n  }\n\n  return  (\n    <Fragment>\n      <section className=\"columns\">\n        <div className=\"col-left\">\n          <FiltersForm {...props} update={update} />\n          <LastTickets />\n        </div>\n        <div className=\"col-right\">\n          <div className=\"results-display\">\n            <div className=\"trains-count\">\n              <span className=\"results-option\">Найдено</span>\n              <span>{count}</span>\n            </div>\n            <div className=\"sort\">\n              <span className=\"results-option\">сортировать по:</span>\n              <ul onClick={handleSortBy} className=\"sort_list\">\n                <li className=\"sort-by\" data-sort=\"date\">отправлению</li>\n                <li className=\"sort-by sort-by-current\" data-sort=\"duration\">длительности</li>\n              </ul>\n            </div>\n            <div className=\"limit\">\n              <span className=\"results-option\">показывать по:</span>\n              <ul className=\"limit_list\" onClick={handleLimit}>\n                <li className=\"limit-by limit-by-current\" data-limit={5}>5</li>\n                <li className=\"limit-by\" data-limit={10}>10</li>\n                <li className=\"limit-by\" data-limit={20}>20</li>\n              </ul>\n            </div>\n          </div>\n          {trains.length > 0 ? \n            trains.map(train => <TrainCard \n                                params={params}\n                                departure={train.departure} \n                                currentTrain={props.currentTrain} \n                                setCurrentTrain={props.setCurrentTrain}/>) :\n            showNotice ? <div className=\"not-found-notice\">К сожалению, ничего не найдено. Попробуйте изменить параметры поиска.</div> : <div className=\"loader\"><div className=\"loader_image\"></div></div>\n          }\n\n          <Pagination \n              trains={trains}\n              count={count} \n              limit={limit} \n              currentPage={currentPage}\n              setCurrentPage={setPage}/> \n        </div>\n      </section>\n    </Fragment>\n  )\n  \n}\n\nexport {SearchPage}\n"]},"metadata":{},"sourceType":"module"}